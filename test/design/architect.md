ä½ æ˜¯ä¸€ä¸ªé«˜çº§ Ruby å¼€å‘åŠ©æ‰‹ï¼Œç†Ÿæ‚‰ Sinatraã€MongoDB å’Œ LLM è§£æã€‚
/api ç›®å½•ä¸‹æœ‰å¦‚ä¸‹éœ€æ±‚:

---

## **ğŸ“Œ ç›®æ ‡**
åˆ›å»ºä¸€ä¸ª **DCIï¼ˆæ•°æ®-ä¸Šä¸‹æ–‡-äº¤äº’ï¼‰+ LLM + è‡ªå­¦ä¹ ** çš„è§£æå¼•æ“ï¼Œé‡‡ç”¨ **Sinatra + MongoDB** ä½œä¸ºåç«¯æ¡†æ¶ï¼Œæä¾› REST APIï¼š

1. **æ•°æ®å±‚ï¼ˆDataï¼‰**  
   - ä½¿ç”¨ MongoDB å­˜å‚¨æ–‡æ¡£ï¼Œæ¯ä¸ªæ–‡æ¡£å¸¦ `_meta` å­—æ®µï¼ŒåŒ…å« `parser`ï¼ˆè§£æå™¨ç±»å‹ï¼‰ã€‚
   - è§£æç»“æœå’Œç”¨æˆ·åé¦ˆå­˜å…¥æ•°æ®åº“ã€‚

2. **ä¸Šä¸‹æ–‡å±‚ï¼ˆContextï¼‰**  
   - è§£æå™¨å¯æ’æ‹”ï¼Œæ”¯æŒï¼š
     - **è§„åˆ™è§£æï¼ˆRuleBasedParserï¼‰**
     - **AI è§£æï¼ˆAIInterpreterï¼ŒåŸºäº LLMï¼‰**
     - **æ··åˆè§£æï¼ˆHybridParserï¼‰**
   - å¯æ ¹æ® `_meta.parser` é€‰æ‹©è§£æå™¨ã€‚

3. **äº¤äº’å±‚ï¼ˆInteractionï¼‰**  
   - æä¾› REST APIï¼š
     - `GET /parse/:id` è§£æ MongoDB ä¸­çš„æ–‡æ¡£
     - `POST /feedback` è®°å½•è§£æåé¦ˆ
   - è§£æå™¨æ”¯æŒè‡ªé€‚åº”ä¼˜åŒ–ï¼ˆåŸºäºç”¨æˆ·åé¦ˆè°ƒæ•´è§£ææ–¹å¼ï¼‰ã€‚

---

## **ğŸ“œ é¡¹ç›®ç»“æ„**
/api
â”‚â”€â”€ models/
â”‚   â”œâ”€â”€ parser.rb         # è§£æå¼•æ“
â”‚   â”œâ”€â”€ rule_based.rb     # è§„åˆ™è§£æå™¨
â”‚   â”œâ”€â”€ ai_interpreter.rb # LLM è§£æå™¨
â”‚   â”œâ”€â”€ hybrid_parser.rb  # æ··åˆè§£æå™¨
â”‚â”€â”€ routes/
â”‚   â”œâ”€â”€ parse_routes.rb   # è§£æ API
â”‚   â”œâ”€â”€ feedback_routes.rb # åé¦ˆ API
â”‚â”€â”€ services/
â”‚   â”œâ”€â”€ llm_service.rb    # LLM å¤„ç†
â”‚   â”œâ”€â”€ rag_service.rb    # RAG å¤„ç†
â”‚â”€â”€ helpers/  # è¾…åŠ©helperç±»
â”‚   â”œâ”€â”€ application_helper.rb # åº”ç”¨å±‚helper

---

## **ğŸ’ å…·ä½“ä»£ç è¦æ±‚**

1. ** `/config.ru`**  
   - web apiçš„å…¥å£ ä½¿ç”¨rackupå‘½ä»¤å¯åŠ¨

2. **`/lib/util/common`**  
   - å…¬å…±æ–¹æ³•ï¼Œ æä¾›äº†è®¿é—®æ•°æ®åº“çš„èƒ½åŠ›, ç»Ÿä¸€ä½¿ç”¨Mè®¿é—®æ•°æ®åº“

3. **`/api/models/parser.rb`ï¼ˆè§£æå¼•æ“ï¼‰**  
   - `select_parser(parser_name)` é€‰æ‹©åˆé€‚çš„è§£æå™¨
   - `parse(data)` è°ƒç”¨ç›¸åº”è§£æå™¨å¤„ç†æ•°æ®

4. **`/api/models/rule_based.rb`ï¼ˆè§„åˆ™è§£æå™¨ï¼‰**  
   - è¯»å– `content` å­—æ®µï¼Œè¿”å›è§„åˆ™è§£æç»“æœã€‚

5. **`/api/models/ai_interpreter.rb`ï¼ˆAI è§£æå™¨ï¼‰**  
   - é€šè¿‡ LLM è§£æ `content`ï¼Œè°ƒç”¨ `services/llm_service.rb`

6. **`/api/models/hybrid_parser.rb`ï¼ˆæ··åˆè§£æå™¨ï¼‰**  
   - å…ˆä½¿ç”¨ `RuleBasedParser`ï¼Œç„¶åè°ƒç”¨ `AIInterpreter`
   - è¿”å›åˆå¹¶ç»“æœ

7. **`/api/services/llm_service.rb`ï¼ˆLLM API æœåŠ¡ï¼‰**  
   - é€šè¿‡ `Faraday` è°ƒç”¨ LLM APIï¼ˆDeepSeek, OpenAI, Claudeç­‰ï¼‰
   - ä¼ å…¥ `prompt`ï¼Œè¿”å›è§£ææ–‡æœ¬

8. **`/api/routes/parse_routes.rb`ï¼ˆè§£æ APIï¼‰**  
   - `GET /parse/:id`ï¼šæ ¹æ® ID è¯»å– MongoDB æ•°æ®ï¼Œè°ƒç”¨è§£æå™¨ï¼Œè¿”å›è§£æç»“æœã€‚

9. **`/api/routes/feedback_routes.rb`ï¼ˆåé¦ˆ APIï¼‰**  
   - `POST /feedback`ï¼šå­˜å‚¨ç”¨æˆ·åé¦ˆï¼Œä¼˜åŒ–è§£æé€»è¾‘ã€‚

10. **`/config.ru`ï¼ˆSinatra å…¥å£ï¼‰**  
   - æ ¹ç›®å½•ä¸Šå·²ç»æœ‰config.ruï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨rackupå‘½ä»¤å¯åŠ¨ã€‚æ‰€ä»¥ä¸è¦å†åˆ›å»ºconfig.ruäº†
   -æ–°å»ºä¸€ä¸ªmap, ç”¨æ¥è½½å…¥ `parse_routes` å’Œ `feedback_routes` å¹¶è¿è¡Œ Sinatraã€‚

---

## **ğŸŒŸ ç”Ÿæˆä»£ç è¦æ±‚**
- **ä»£ç åº”æ¸…æ™°ã€å¯è¯»ã€æ¨¡å—åŒ–**
- **éµå¾ª Sinatra & MongoDB æœ€ä½³å®è·µ**
- **æ”¯æŒæœªæ¥æ‰©å±•ï¼Œä¾‹å¦‚ RAGã€å‘é‡æ•°æ®åº“**
- **é”™è¯¯å¤„ç†å®Œå–„**
- **ç”Ÿæˆå®Œæ•´é¡¹ç›®ä»£ç **
- **æ˜¯åœ¨åŸæœ‰æ¶æ„åŸºç¡€ä¸Šå¢åŠ ä¸œè¥¿è¿›è¡Œæ”¹é€ **

è¯·æŒ‰ä»¥ä¸Šç»“æ„ **å®Œæ•´ç”Ÿæˆ Sinatra é¡¹ç›®ä»£ç **ï¼Œå¹¶ç¡®ä¿å¯ä»¥è¿è¡Œã€‚è°¢è°¢ï¼